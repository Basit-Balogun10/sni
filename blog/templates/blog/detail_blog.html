{% extends 'base.html' %}
{% load blog_extras %}


{% block content %}


<style type="text/css">
	#login-message {
		display: none;
	}

	html,
	body {
		background: linear-gradient(35deg, #002657, #c582eb);
	}

	.grid-container5 {
		display: inline-grid;
		grid-template-columns: 65% 30%;
		grid-column-gap: 3.5rem;
		margin: 5%;
	}

	img.post-img {
		width: 100%;
		height: 40rem;
	}

	.post-title {
		font-size: 3rem;
		text-align: center;

	}

	.post-info {
		font-size: 1.5rem;
		color: skyblue;
		font-weight: bold;
		margin-bottom: 10px;
	}

	.post-header {
		margin-bottom: 3rem;
		color: #002657;
		text-align: center;

	}

	.post-text {
		font-size: 1.6rem;
		padding: 5%;
		border: 7px solid #C582EB;
		border-radius: 7px;
		border-left-color: skyblue;
		border-right-color: skyblue;
		border-top-style: double;
		border-bottom-style: double;
		color: antiquewhite;
	}

	.comment-section {
		margin-top: 10rem;
		font-size: 1.6rem;
	}

	textarea.comment-box {
		width: 100%;
	}

	button.submit-comment {
		color: #c582eb;
		padding: 9px;
		border-radius: 7px;
		border: 2px solid #002657;
		transition: background-color, border 1s;
		cursor: pointer;
		text-align: center;
		font-size: 2.3rem;
		margin-top: 10px;
		background: #002657;
	}

	button.submit-comment:hover {
		color: #002657;
		background: #c582eb;
		border: #c582eb;
		padding: 9px;
	}

	span.info-head,
	span.author {
		color: #002657;
	}

	span.category {
		border: 1px solid #002657;
		background: #002657;
		color: #c582eb;
		padding: 0.9rem;
		margin-left: 1.2rem;
		border-radius: 3rem;
	}

	p.post-category {
		margin-top: 4rem;
		margin-bottom: 4rem;
		font-size: 1.8rem;
	}

	.reply {
		margin-left: 5%;
		margin-bottom: 2%;
	}

	.reply-div {
		display: none;
	}

	.read-more {
		display: inline-grid;
		grid-template-rows: 33.3% 33.3% 33.3%;
		margin-top: 35px
	}


	.head {
		display: flex;
		justify-content: center;
		margin-bottom: 30px;
	}

	form {
		text-align: center;
	}

	button.text {
		cursor: pointer;
		font-size: 1.8rem;
		padding-top: 1.5rem;
		border: 0.1rem solid #002657;
		padding: 0.9rem;
		text-align: center;
		border-radius: 3rem;
		background: #002657;
		color: #c582eb;
		font-weight: bold;
		font-family: apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif;
	}

	button.text span {
		color: skyblue;
	}

	button.text:hover {
		background: #c582eb;
		color: #002657;
		border: 0.1rem solid #c582eb;
	}

	.read-more>div {
		margin-top: 2rem;
	}

	.post-container {
		display: inline-grid;
		grid-template-columns: 40% 60%;
		border-top: 2px solid #002657;
		margin-top: 2px;
		padding-top: 2px;
		grid-column-gap: 5px;
	}

	.post-image {
		width: 100%;
		height: 100px;
	}

	.post-ttl {
		font-size: 1.7rem;
		color: white;
	}

	p.post-time {
		font-size: 1.2rem;
		color: #002657;
		font-weight: bold;
	}

	p.post-author {
		font-size: 1.2rem;
		color: #91d9f7;
	}

	button.see-more {
		cursor: pointer;
		font-size: 1.7rem;
		margin-left: 60%;
		padding: 5px;
		color: white;
		background: skyblue;
		border-radius: 5px;
		border: 1px solid skyblue;
		font-family: apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif;
	}
</style>

<section id="hero" style="background-image: url('{{blog_post.image.url}}');" class="
        d-flex justify-content-center align-items-center">
	<div class="container text-center position-relative" data-aos="zoom-in" data-aos-delay="100">
		<h1>{{blog_post.title}}</h1>
		<div class="trainer align-items-center text-center">
			<div class="trainer-profile d-flex justify-content-between align-items-center">
				<div class="author-detail d-flex">
					<img src="{{blog_post.author_img.url}}" class="img-fluid" alt="">
					<span>{{blog_post.author.firstname}} {{ blog_post.author.lastname}}</span>
				</div>
				<div class="feedback d-flex">
					<i class="fa fa-thumbs-up"></i>&nbsp;{{ blog_post.num_likes }}
					&nbsp;&nbsp;
					<i class="fa fa-thumbs-down"></i>&nbsp;{{ blog_post.num_dislikes }}&nbsp;&nbsp;
					<i class="fa fa-comments"></i>&nbsp;{{ blog_post.total_comments }}
				</div>
			</div>
			<div class="trainer-rank d-block text-center align-items-center">
				<p><span>Published: </span>{{blog_post.date_published|date:"r"}}</p>
				<p><span>Updated: </span>{{blog_post.date_updated|date:"r"}}</p>
			</div>
		</div>
		<a href="#about" class="btn-get-started">Jump to Main Content</a>
	</div>
</section>

{% comment %} <div class="container"> {% endcomment %}
	{% comment %} <div class="row">

		<!-- Blog Post -->
		<div class="card m-auto">
			<img class="card-img-top" src="{{blog_post.image.url}}">
			<div class="card-body mt-2 mb-2">
				<h2 class="card-title">{{blog_post.title}}</h2>
				<p class="card-text">{{blog_post.body|safe}}</p>
			</div>
			<div class="card-footer text-muted">
				Updated on {{blog_post.date_updated}} by {{blog_post.author}}
			</div>
		</div>
	</div> {% endcomment %}


	<!-- {% concat_all blog_post.date_published.hour|stringformat:"i" '-' blog_post.date_published.minute|stringformat:"i" '-' blog_post.date_published.second|stringformat:"i" '-' blog_post.date_published.microsecond|stringformat:"i"  as blog_time_published %}
	<div class="grid-container5">
		<div class="main-article">
			<div class="post-header">
				<div class="post-info">
					{% if blog_post.date_published != blog_post.date_updated %}
					<p><span class="info-head">Date Published: </span>{{blog_post.date_published|myfunc}} <span
							class="published author">by
							{{blog_post.author}}</span></p>
					<br>
					<p><span class="info-head">Date Updated: </span>{{blog_post.date_updated|myfunc}} <span
							class="updated author">by
							{{blog_post.author}}</span></p>
					{% else %}
					<p><span class="info-head">Date Published: </span>{{blog_post.date_published|myfunc}} <span
							class="published author">by
							{{blog_post.author}}</span></p>
					{% endif %}

					<p class="post-category"><span class="info-head">Category: </span><span
							class="category">{{ blog_post.category|upper }}</span></p>
					<a class="likebutton btn btn-{{like_color}} btn-lg" id="like{{ blog_post.id }}" href="#"
						data-catid="{{ blog_post.id }}" data-value="{{blog_post.num_likes}}">{{blog_post.num_likes}} <i
							class="fa fa-thumbs-up"></i></a>
					<a class="dislikebutton btn btn-{{dislike_color}} btn-lg" id="dislike{{ blog_post.id }}" href="#"
						data-catid="{{ blog_post.id }}"
						data-value="{{blog_post.num_dislikes}}">{{blog_post.num_dislikes}} <i
							class="fa fa-thumbs-down"></i></a>
					<h3 id="login-message" style="display: none;">Sorry, you have to be logged in to like or dislike
						posts</h3>
				</div>
				<h2 class="post-title">{{blog_post.title}}</h2>
			</div>
			<div class="post-content">
				<img class="post-img" src="{{blog_post.image.url}}">
				<p class="post-text">{{blog_post.body|safe}}</p>
			</div>

			<div class="container">
				<div class="row">
					<div class="col-md-8 card mb-4  mt-3 ">
						<div class="card-body">
							<h2 id="comments-count" data-value={{blog_post.total_comments}}>
								{{ blog_post.total_comments }} comments</h2>

							<div id="comment-container">
								{% for comment in comments %}
								<div class="comments" id="{{comment.id}}" style="padding: 10px;">
									<p class="font-weight-bold">
										{{ comment.commenter }}
										<span class=" text-muted font-weight-normal">
											{{ comment.created_on|myfunc }}
										</span>
									</p>
									{{ comment.comment_body | safe | linebreaks }}
									<div>
										<a class="show-reply-form" onclick="replyComment(this)"
											href="javascript:void(0)" id="show-reply-form_{{comment.id}}"
											title="Reply to this comment">Reply</a>
										<div class="reply-div" id="reply-div{{comment.id}}">
											<form id="reply-form{{comment.id}}" class="reply-form" method="post"
												style="margin-top: 1.3em;" name="r-form" value="{{comment.id}}">
												{% csrf_token %}
												{{ reply_form.as_p }}
												<input type="hidden" name="parent_id" value="{{comment.id}}">
												<input name="action" type="hidden" value="to_reply">
												<button class="btn btn-primary btn-lg reply-button"
													id="reply-button{{comment.id}}" type="submit">Submit</button>
											</form>
										</div>
									</div>
									{% for reply in comment.replies.all %}
									<div class="reply">
										<p class="font-weight-bold">
											{{ reply.replier }}
											<span class="text-muted font-weight-normal">
												{{ reply.created_on|myfunc }}
											</span>
										</p>

										{{ reply.body | safe | linebreaks }}
									</div>
									{% endfor %}
								</div>
								{% endfor %}
							</div>
						</div>
					</div>
					<div class="col-md-8 card mb-4  mt-3 ">
						<div class="card-body">
							{% if new_comment %}
							<div class="alert alert-success" role="alert">
								Your comment is awaiting moderation
							</div>
							{% else %}
							{% concat_all post.date_published.hour|stringformat:"i" '-' post.date_published.minute|stringformat:"i" '-' post.date_published.second|stringformat:"i" '-' post.date_published.microsecond|stringformat:"i"  as blog_time_published %}
							<h3>Leave a comment</h3>
							<form method="post" style="margin-top: 1.3em;" id="comment-form">
								{% csrf_token %}
								{{ comment_form.as_p }}
								<input name="action" type="hidden" value="to_comment">
								<button class="btn btn-primary btn-lg comment-button" id="comment-button"
									type="submit">Submit</button>
							</form>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="read-more">
			<div class="trending-posts">
				<div class="head">
					<form action="{% url 'blog:home' %}" method="get">
						<button class="text" type="submit" name="posted-since" id="trending-category"
							value="{{blog_post.date_updated}}">
							TRENDING POSTS</button>
					</form>
				</div>
				{% for post in trending_posts %}
				{% concat_all post.date_published.hour|stringformat:"i" '-' post.date_published.minute|stringformat:"i" '-' post.date_published.second|stringformat:"i" '-' post.date_published.microsecond|stringformat:"i"  as blog_time_published %}
				<div class="post-container" onmouseover="activateDiv(this)" onmouseout="deactivateDiv(this)">

					<div class="post-image-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}"><img
								class="post-image" src="{{post.image.url}}"></a>
					</div>

					<div class="post-summary-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}">
							<p class="post-ttl">{{post.title}}</p>
							<p class="post-time">{{post.date_updated|myfunc}}</p>
							<p class="post-author">By {{post.author}}</p>
						</a>
					</div>
				</div>
				{% endfor %}
				<form action="{% url 'blog:home' %}" method="get">
					<button class="see-more" type="submit" name="posted-since" id="seemore-trending"
						value="{{blog_post.date_updated}}">
						See More >>>
					</button>
				</form>
			</div>

			<div class="related-posts">
				<div class="head">
					<form action="{% url 'blog:home' %}" method="get">
						<button class="text" type="submit" name="related-to" id="related-category"
							value="{{blog_post.title}}">
							RELATED POSTS</button>
					</form>
				</div>
				{% for post in related_posts %}
				{% concat_all post.date_published.hour|stringformat:"i" '-' post.date_published.minute|stringformat:"i" '-' post.date_published.second|stringformat:"i" '-' post.date_published.microsecond|stringformat:"i"  as blog_time_published %}
				<div class="post-container" onmouseover="activateDiv(this)" onmouseout="deactivateDiv(this)">


					<div class="post-image-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}"><img
								class="post-image" src="{{post.image.url}}"></a>
					</div>

					<div class="post-summary-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}">
							<p class="post-ttl">{{post.title}}</p>
							<p class="post-time">{{post.date_updated|myfunc}}</p>
							<p class="post-author">By {{post.author}}</p>
						</a>
					</div>

				</div>
				{% endfor %}
				<form action="{% url 'blog:home' %}" method="get">
					<button class="see-more" type="submit" name="related-to" id="seemore-related"
						value="{{blog_post.title}}">
						See More >>>
					</button>
				</form>
			</div>

			<div class="author-posts">
				<div class="head">
					<form action="{% url 'blog:home' %}" method="get">
						<button class="text" type="submit" name="posts-from" id="author-category"
							value="{{blog_post.author}}">MORE
							POSTS FROM
							<span>{{blog_post.author|upper}}</span></button>
					</form>
				</div>
				{% for post in author_posts %}
				{% concat_all post.date_published.hour|stringformat:"i" '-' post.date_published.minute|stringformat:"i" '-' post.date_published.second|stringformat:"i" '-' post.date_published.microsecond|stringformat:"i"  as blog_time_published %}
				<div class="post-container" onmouseover="activateDiv(this)" onmouseout="deactivateDiv(this)">

					<div class="post-image-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}">
							<img class="post-image" src="{{post.image.url}}"></a>
					</div>

					<div class="post-summary-container">
						<a
							href="{% url 'blog:detail' post.category post.date_published.year post.date_published.month post.date_published.day blog_time_published post.id post.title|slugify %}">
							<p class="post-ttl">{{post.title}}</p>
							<p class="post-time">{{post.date_updated|myfunc}}</p>
							<p class="post-author">By {{post.author}}</p>
						</a>
					</div>
				</div>
				{% endfor %}
				<form action="{% url 'blog:home' %}" method="get">
					<button class="see-more" type="submit" name="posts-from" id="seemore-from-author"
						value="{{blog_post.author}}">
						See More >>>
					</button>
				</form>
			</div>
		</div>
	</div>
</div> -->
	<script type="text/javascript">
		$('.likebutton').click(function () {
			if ('{{ request.user.is_authenticated }}' === 'True') {
				var id;
				var likes;
				id = $(this).attr("data-catid");
				likes = $(this).data("value");
				dislikes = $('#dislike' + id).data("value");
				console.log(likes + ' l')
				console.log(dislikes + 'd')
				$.ajax({
					type: "POST",
					url: "",
					data: {
						post_id: id,
						'csrfmiddlewaretoken': '{{ csrf_token }}',
						action: 'to_like'
					},
					success: function (data) {
						if ($('#like' + id).hasClass('btn-primary') & $('#dislike' + id).hasClass(
								'btn-success')) {
							$('#like' + id).removeClass('btn btn-primary btn-lg');
							$('#like' + id).addClass('btn btn-success btn-lg');
							$('#dislike' + id).removeClass('btn btn-success btn-lg');
							$('#dislike' + id).addClass('btn btn-primary btn-lg');

							dislikes = dislikes - 1;
							likes = likes + 1;
							console.log(likes + ',' + dislikes)
							$("#like" + id).data('value', likes)
							$("#dislike" + id).data('value', dislikes)

							$('#dislike' + id).html(
								dislikes + ' <i class="fa fa-thumbs-down"></i>');
							$('#like' + id).html((likes +
								' <i class="fa fa-thumbs-up"></i>'));
						} else if ($('#like' + id).hasClass('btn-success') & $('#dislike' + id).hasClass(
								'btn-primary')) {
							$('#like' + id).removeClass('btn btn-success btn-lg');
							$('#like' + id).addClass('btn btn-primary btn-lg');

							likes = likes - 1;
							console.log(likes + ' l')
							$("#like" + id).data('value', likes)

							$('#like' + id).html(
								likes + ' <i class="fa fa-thumbs-up"></i>');
						} else if ($('#like' + id).hasClass('btn-primary') & $('#dislike' + id).hasClass(
								'btn-primary')) {
							$('#like' + id).removeClass('btn btn-primary btn-lg');
							$('#like' + id).addClass('btn btn-success btn-lg');

							likes = likes + 1;
							console.log(likes + ' l')
							$("#like" + id).data('value', likes)

							$('#like' + id).html(
								likes + ' <i class="fa fa-thumbs-up"></i>');
						}
					}
				})
			} else {
				console.log('NOT AUTHENTICATED')
				document.getElementById("login-message").style.display = "block";
			};
		});
		$('.dislikebutton').click(function () {
			if ('{{ request.user.is_authenticated }}' === 'True') {
				var id;
				var dislikes;
				id = $(this).attr("data-catid");
				dislikes = $(this).data("value");
				likes = $('#like' + id).data("value");
				console.log(dislikes + 'd');
				console.log(likes + ' l')
				$.ajax({
					type: "POST",
					url: "",
					data: {
						post_id: id,
						'csrfmiddlewaretoken': '{{ csrf_token }}',
						action: 'to_dislike'
					},
					success: function (data) {
						if ($('#like' + id).hasClass('btn-primary') & $('#dislike' + id).hasClass(
								'btn-success')) {
							$('#dislike' + id).removeClass('btn btn-success btn-lg');
							$('#dislike' + id).addClass('btn btn-primary btn-lg');

							dislikes = dislikes - 1;
							console.log(dislikes + 'd')
							$("#dislike" + id).data('value', dislikes)

							$('#dislike' + id).html(
								dislikes + ' <i class="fa fa-thumbs-down"></i>');
						} else if ($('#like' + id).hasClass('btn-success') & $('#dislike' + id).hasClass(
								'btn-primary')) {
							$('#like' + id).removeClass('btn btn-success btn-lg');
							$('#like' + id).addClass('btn btn-primary btn-lg');
							$('#dislike' + id).removeClass('btn btn-primary btn-lg');
							$('#dislike' + id).addClass('btn btn-success btn-lg');

							dislikes = dislikes + 1;
							likes = likes - 1;
							console.log(likes + ',' + dislikes)
							$("#like" + id).data('value', likes)
							$("#dislike" + id).data('value', dislikes)

							$('#dislike' + id).html(
								dislikes + ' <i class="fa fa-thumbs-down"></i>');
							$('#like' + id).html((likes +
								' <i class="fa fa-thumbs-up"></i>'));
						} else if ($('#like' + id).hasClass('btn-primary') & $('#dislike' + id).hasClass(
								'btn-primary')) {
							$('#dislike' + id).removeClass('btn btn-primary btn-lg');
							$('#dislike' + id).addClass('btn btn-success btn-lg');

							dislikes = dislikes + 1;
							$("#dislike" + id).data('value', dislikes)

							console.log(dislikes + 'd')
							$('#dislike' + id).html(
								dislikes + ' <i class="fa fa-thumbs-down"></i>');
						}
					}
				})
			} else {
				console.log('NOT AUTHENTICATED')
				document.getElementById("login-message").style.display = "block";
			}
		});

		// $('.comment-button').click(function () {
		// 	if ('{{ request.user.is_authenticated }}' === 'True') {
		// 		var commentsCount, commentContainer;
		// 		commentsCount = document.getElementById('comments-count');
		// 		count = $('#comments-count').data("value");
		// 		commentContainer = document.getElementById('comment-container');
		// 		$.ajax({
		// 			type: "POST",
		// 			url: "",
		// 			data: {
		// 				'csrfmiddlewaretoken': '{{ csrf_token }}',
		// 				action: 'to_comment'
		// 			},
		// 			success: function (data) {
		// 				count += 1;
		// 				console.log('{{request.user}}');
		// 				commentsCount.innerHTML = count + " comments";

		// 				commentContainer.innerHTML +=
		// 					'<div class="comments" style="padding: 10px;"><p class="font-weight-bold">{{ request.user }}<span class=" text-muted font-weight-normal">{{ new_comment.created_on }}</span></p>{{ new_comment.body | linebreaks }}<a href="javascript:void(0)" class="reply-button" id="reply-button" onclick="replyComment(this)" title="Reply to this comment">Reply</a><div class="reply-div" id="reply-div"><form method="post" style="margin-top: 1.3em;">{% csrf_token %}{{ reply_form.as_p }}<input type="hidden" name="parent_id" value="{{new_comment.id}}"><button type="submit" class="btn btn-primary btn-lg reply-button" name="action" value="to_reply">Submit</button></form></div>{% for reply in new_comment.replies.all %}<div class="reply"><p class="font-weight-bold">{{ reply.replier }}<span class="text-muted font-weight-normal">{{ reply.created_on }}</span></p>{{ reply.body | linebreaks }}</div>{% endfor %}</div>';
		// 			}
		// 		})
		// 	}
		// });

		$(document).ready(function () {
			count = $('#comments-count').data("value");
			comments = '{{comments.count}}';
			counter = 0;
			$("#comment-button").click(function () {
				console.log('ready')
				console.log(this.className);
				$("#comment-form").submit(function (event) {
					event.preventDefault();
					console.log('submitted')
					var commentsCount, commentContainer;
					form = document.getElementById('comment-form');
					commentsCount = document.getElementById('comments-count');
					commentContainer = document.getElementById('comment-container');
					$.ajax({
						data: $("#comment-form").serialize(),
						type: "POST",
						url: "",
						success: function (response) {
							console.log(response);
							console.log($("#comment-form").serialize());
							if ('{{ request.user.is_authenticated }}' === 'True' &
								decodeURIComponent($("#comment-form").serialize().split(
									'body=')[1].split('&action')[0]) != '') {
								count += 1;
								console.log('{{request.user}}');
								commentsCount.innerHTML = count + " comments";

								serialized = $("#comment-form").serialize();
								myArray = serialized.split('body=');
								frag = myArray[1];
								newArray = frag.split('&action');
								encodedTxt = newArray[0];
								reply_body = decodeURIComponent(encodedTxt);

								ctime = new Date();
								ctime = String(ctime).split(' ');
								ctime[0] = ctime[0] + ',';
								ctime[2] = ctime[2] + ',';
								ctime = ctime.join(' ');

								replyButtonId = 'show-reply-form_' + String(Number(
									comments) + 1)
								replyDivId = 'reply-div' + String(Number(comments) + 1)
								console.log(reply_body);
								commentContainer.insertAdjacentHTML('beforeEnd',
									'<div class="comments" id="' + String(Number(
										comments) + 1) + '" ' +
									'style="padding: 10px;"><p class="font-weight-bold">{{ request.user }} <span class=" text-muted font-weight-normal">' +
									ctime + '</span></p>' + reply_body +
									'</br><div><a href="javascript:void(0)" class="show-reply-form" id=' +
									replyButtonId +
									' onclick="alertMessage()" title="Reply to this comment">Reply</a><div class="reply-div" id=' +
									replyDivId +
									'><form method="post" style="margin-top: 1.3em;" class="reply-form" name="r-form" value="' +
									String(Number(comments) + 1) + '" ' +
									'id="reply-form' + String(Number(comments) + 1) +
									'">{% csrf_token %}{{ reply_form.as_p }}<input type="hidden" name="parent_id" value="' +
									String(Number(comments) + 1) +
									'"><input name="action" type="hidden" value="to_reply"><button type="submit" class="btn btn-primary btn-lg reply-button" id="reply-button' +
									String(Number(comments) + 1) +
									'">Submit</button></form></div></div>{% for reply in new_comment.replies.all %}<div class="reply"><p class="font-weight-bold">{{ reply.replier }}<span class="text-muted font-weight-normal">{{ reply.created_on }}</span></p>{{ reply.body | safe | linebreaks }}</div>{% endfor %}</div>'
								);
								form.removeChild(document.getElementById(
									'comment-button'));
								form.insertAdjacentHTML('beforeEnd',
									'<button class="btn btn-primary btn-lg comment-button" id="comment-button" type="submit">Submit</button>'
								);
							} else {
								if (decodeURIComponent($("#comment-form").serialize()
										.split('body=')[1].split('&action')[0]) != '') {
									form.removeChild(document.getElementById(
										'comment-button'));
									form.insertAdjacentHTML('beforeEnd',
										'<button class="btn btn-primary btn-lg comment-button" id="comment-button" type="submit">Submit</button>'
									);
								}

							}
						},
						error: function (request, status, error) {
							console.log(request.responseText);
						}
					});
				});
				// $("#comment-form").submit();
			});


			$(".reply-button").click(function () {
				console.log('ready');
				replyButton = this;
				console.log(replyButton)
				replyForm = this.parentElement;
				console.log(replyForm);
				formId = replyForm.id;
				console.log(formId)
				$('#' + formId).submit(function (event) {
					event.preventDefault();
					console.log('submitted')
					var commentsCount, commentContainer;
					// form = document.getElementById("reply-form");
					commentsCount = document.getElementById('comments-count');
					parentId = $('#' + formId).attr('value');
					commentContainer = document.getElementById(parentId);

					$.ajax({
						data: $('#' + formId).serialize(),
						type: "POST",
						url: "",
						success: function (response) {
							console.log(response);
							console.log($('#' + formId).serialize());
							if ('{{ request.user.is_authenticated }}' === 'True' &
								decodeURIComponent($('#' + formId).serialize().split(
									'body=')[1].split('&parent_id')[0]) != '') {
								count += 1;
								console.log('{{request.user}}');
								commentsCount.innerHTML = count + " comments";

								serialized = $('#' + formId).serialize();
								myArray = serialized.split('body=');
								frag = myArray[1];
								newArray = frag.split('&parent_id');
								encodedTxt = newArray[0];
								reply_body = decodeURIComponent(encodedTxt);

								ctime = new Date();
								ctime = String(ctime).split(' ');
								ctime[0] = ctime[0] + ',';
								ctime[2] = ctime[2] + ',';
								ctime = ctime.join(' ');

								console.log(reply_body);
								commentContainer.insertAdjacentHTML('beforeEnd',
									'<div class="reply"><p class="font-weight-bold">{{ request.user }}<span class="text-muted font-weight-normal">' +
									ctime + '</span></p>' + reply_body + '</div>');
								replyForm.removeChild(replyForm.lastElementChild);
								replyForm.insertAdjacentHTML('beforeEnd',
									'<button class="btn btn-primary btn-lg reply-button" id="reply-button' +
									parentId + '" ' + 'type="submit">Submit</button>');
							} else {
								if (decodeURIComponent($('#' + formId).serialize().split(
										'body=')[1].split('&parent_id')[0]) != '') {
									replyForm.removeChild(replyForm.lastElementChild);
									replyForm.insertAdjacentHTML('beforeEnd',
										'<button class="btn btn-primary btn-lg reply-button" id="reply-button' +
										parentId + '" ' +
										'type="submit">Submit</button>');
								}

							}
						},
						error: function (request, status, error) {
							console.log(request.responseText);
						}
					});

				});
				// $("#comment-form").submit();
			});

			// $('.show-reply-form').click( function () {
			// 	object = this;
			// 	objectId= Number(object.id.split('_')[1]);
			// 	parentDiv = object.parentElement;

			// 	replyDiv = document.getElementById('reply-div' + String(objectId));
			// 	console.log(replyDiv);
			// 	if (replyDiv) {
			// 		console.log(replyDiv);
			// 		console.log('na here');
			// 		parentDiv.removeChild(replyDiv);
			// 	} else {
			// 		for (let element of document.getElementsByClassName('reply-div')) {
			// 			element.remove();
			// 		}

			// 		parentDiv.insertAdjacentHTML('beforeEnd', '<div class="reply-div" id="reply-div' + String(objectId) + '" ' + '><form id="reply-form' + String(objectId) + '" ' + 'class="reply-form" method="post" style="margin-top: 1.3em;" name="r-form" value="' + String(objectId) + '"' + '>{% csrf_token %}{{ reply_form.as_p }}<input type="hidden" name="parent_id" value="' + String(objectId) + '"' + '><input name="action" type="hidden" value="to_reply"><button class="btn btn-primary btn-lg reply-button" id="reply-button' + String(objectId) + '" ' + 'type="submit">Submit</button></form>');
			// 		// parentDiv.insertAdjacentElement('beforeEnd', document.getElementsByClassName('reply-div')[0]);
			// 		replyDiv = parentDiv.lastElementChild;
			// 		replyDiv.id = 'reply-div' + String(objectId);
			// 		replyForm = replyDiv.children[0];
			// 		replyForm.id = 'reply-form' + String(objectId);
			// 		replyForm.setAttribute('value', String(objectId))
			// 		replyForm.children[2].setAttribute('value', String(objectId))
			// 		replyForm.lastElementChild.id = String(objectId);
			// 		replyDiv.style.display = 'block';
			// 		formSelector = '#' + replyForm.id;
			// 		area = replyForm.children[1].children[1];
			// 		counter += 1
			// 		area.className += String(counter);
			// 		// tinymce.init({
			//         //         selector: 'textarea#id_body.tinymce' + String(counter)
			//         // });


			// 	}
			// });
		});

		// $(document).ready(function () {

		// })
		// tinymce.init({
		// 	selector:'.editor',
		// 	setup: function (editor) {
		// 		editor.on('submit', function (e) {
		// 			editor.save();
		// 		});
		// 	}
		// });
	</script>
	{% endblock content %}